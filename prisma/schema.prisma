// This block defines the database connection.
// Prisma reads this from your .env file.
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// This block tells Prisma to generate the client.
// This is the standard configuration.
generator client {
  provider = "prisma-client-js"
}

// --- Enum Definitions ---
// Defines a set of allowed values for the Role.
enum UserRole {
  PATIENT
  DOCTOR
  ADMIN
  CASHIER
}

// Defines the status of a contact issue
enum IssueStatus {
  PENDING
  REPLIED
}

// --- Model Definitions ---

// Base User model for login and common info
model User {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  password   String // We will store a hashed password
  role       UserRole @default(PATIENT)
  firstName  String
  tckn  String   @unique // TCKN
  lastName   String
  phoneNumber      String?  @unique // '?' means optional
  dateOfBirth DateTime?

  // Password reset fields
  resetToken        String?   @unique
  resetTokenExpiry  DateTime?

  // Email verification fields
  isEmailVerified   Boolean   @default(false)
  emailToken        String?   @unique
  emailTokenExpiry  DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // --- Relationships ---
  // A user can be ONE patient (1-to-1)
  patient Patient?
  // A user can be ONE doctor (1-to-1)
  doctor  Doctor?
  // A user can be ONE admin (1-to-1)
  admin   Admin?

  @@map("users") // Maps this model to the "users" table in Postgres
}

// Patient model, linked to a User
model Patient {
  id     Int  @id @default(autoincrement())
  userId Int  @unique // Foreign key
  user   User @relation(fields: [userId], references: [id])

  // Patient-specific fields
  address          String?
  emergencyContact String?
  bloodType        String?

  // medicalHistory String? // We can add more fields later

  // --- Relationships ---
  // A patient can have MANY appointments
  appointments Appointment[]

  @@map("patients")
}

// Doctor model, linked to a User
model Doctor {
  id     Int  @id @default(autoincrement())
  userId Int  @unique // Foreign key
  user   User @relation(fields: [userId], references: [id])

  // Doctor-specific fields
  specialization String
  // bio            String? // We can add more fields later

  // --- Relationships ---
  // A doctor can have MANY appointments
  appointments Appointment[]
  // A doctor can have MANY leave requests
  leaveRequests LeaveRequest[]

  @@map("doctors")
}

// Admin model, linked to a User
model Admin {
  id     Int  @id @default(autoincrement())
  userId Int  @unique // Foreign key
  user   User @relation(fields: [userId], references: [id])

  // Admin-specific fields
  // permissionsLevel Int? // We can add more fields later

  @@map("admins")
}

// Appointment model
model Appointment {
  id        Int     @id @default(autoincrement())
  patientId Int
  patient   Patient @relation(fields: [patientId], references: [id])
  doctorId  Int
  doctor    Doctor  @relation(fields: [doctorId], references: [id])

  date      String  // Format: DD.MM.YYYY (e.g., "25.11.2025")
  time      String  // Format: HH:MM (e.g., "10:00")
  status    String  // "PENDING", "APPROVED", "CANCELLED", "COMPLETED"

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("appointments")
}

// Leave Request model for doctors
model LeaveRequest {
  id        Int     @id @default(autoincrement())
  doctorId  Int
  doctor    Doctor  @relation(fields: [doctorId], references: [id])

  startDate String  // Format: YYYY-MM-DD
  startTime String  // Format: HH:MM
  endDate   String  // Format: YYYY-MM-DD
  endTime   String  // Format: HH:MM
  reason    String

  status    String  // "PENDING", "APPROVED", "REJECTED"

  requestedAt DateTime @default(now())
  resolvedAt  DateTime?

  @@map("leave_requests")
}

// Contact Issue model for visitor contact forms
model ContactIssue {
  id           Int         @id @default(autoincrement())
  name         String
  email        String
  phone        String
  subject      String
  message      String
  status       IssueStatus @default(PENDING)
  replyMessage String?     // Admin's reply message
  repliedAt    DateTime?   // When the admin replied

  createdAt    DateTime    @default(now())

  @@map("contact_issues")
}
